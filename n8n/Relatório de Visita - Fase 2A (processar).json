{
  "name": "Relat√≥rio de Visita - Fase 2A (processar)",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "fase2-processar",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "bdd82d3c-2e9f-49b5-bd67-d9af284eb0f6",
      "name": "Webhook - Recebe do Bot",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        -544,
        -432
      ],
      "webhookId": "fase2-processar"
    },
    {
      "parameters": {
        "jsCode": "// ===== MODO DE TESTE =====\n// Altere MODO_TESTE para false para usar dados do webhook\n// Altere CENARIO_TESTE para testar diferentes cen√°rios\nconst MODO_TESTE = false; // true = usa dados de teste, false = usa dados do webhook\nconst CENARIO_TESTE = 'simples'; // Escolha o cen√°rio abaixo\n\nlet payload = {};\n\nif (MODO_TESTE) {\n  // ===== CEN√ÅRIOS DE TESTE =====\n  \n  const cenarios = {\n    // ===== CEN√ÅRIOS B√ÅSICOS =====\n    \n    // Cen√°rio 1: Invent√°rio simples (tudo encontrado na base)\n    simples: {\n      notion_page_id: 'test-notion-page-id-12345',\n      inventario_texto: 'arroz: 500g, feij√£o: 300g, macarr√£o: 250g, leite: 500ml, azeite: 200ml',\n      foto_inventario_base64: ''\n    },\n    \n    // Cen√°rio 2: Invent√°rio com erros de digita√ß√£o (testa fuzzy search)\n    com_erros: {\n      notion_page_id: 'test-notion-page-id-12345',\n      inventario_texto: 'aroz: 500g, feijao: 300g, macarrao: 250g, leite integral: 500ml, azeite de oliva: 200ml, acucar: 1kg',\n      foto_inventario_base64: ''\n    },\n    \n    // Cen√°rio 3: Invent√°rio com temperos sens√≠veis\n    temperos_sensiveis: {\n      notion_page_id: 'test-notion-page-id-12345',\n      inventario_texto: 'arroz: 500g, pimenta do reino: 50g, a√ßafr√£o da terra: 30g, canela: 25g, p√°prica: 40g, cominho: 20g',\n      foto_inventario_base64: ''\n    },\n    \n    // Cen√°rio 4: Invent√°rio completo (m√∫ltiplas categorias, erros, temperos)\n    completo: {\n      notion_page_id: 'test-notion-page-id-12345',\n      inventario_texto: 'arroz: 500g, feij√£o preto: 300g, macarr√£o espaguete: 250g, leite integral: 500ml, azeite de oliva: 200ml, a√ß√∫car: 1kg, sal: 500g, pimenta do reino: 50g, a√ßafr√£o da terra: 30g, canela em p√≥: 25g, p√°prica doce: 40g, cominho: 20g, curry: 35g, tomate: 5 unidades, cebola: 3 unidades, alho: 1 cabe√ßa, lim√£o: 4 unidades',\n      foto_inventario_base64: ''\n    },\n    \n    // ===== CEN√ÅRIOS REALISTAS DO DIA A DIA =====\n    \n    // Cen√°rio 5: Cliente com restri√ß√µes (sem lactose, sem gl√∫ten)\n    restricoes_alimentares: {\n      notion_page_id: 'test-notion-page-id-12345',\n      inventario_texto: 'arroz: 800g, quinoa: 300g, batata doce: 1kg, frango: 600g, leite de am√™ndoas: 1L, azeite: 250ml, sal rosa: 400g, pimenta: 30g, alho: 2 cabe√ßas, cebola: 4 unidades, tomate: 6 unidades, br√≥colis: 400g',\n      foto_inventario_base64: ''\n    },\n    \n    // Cen√°rio 6: Fam√≠lia grande (muitas por√ß√µes)\n    familia_grande: {\n      notion_page_id: 'test-notion-page-id-12345',\n      inventario_texto: 'arroz: 2kg, feij√£o: 1.5kg, macarr√£o: 1kg, carne mo√≠da: 2kg, frango: 3kg, leite: 3L, ovos: 30 unidades, √≥leo: 900ml, sal: 1kg, a√ß√∫car: 2kg, farinha de trigo: 2kg, tomate: 15 unidades, cebola: 10 unidades, alho: 3 cabe√ßas, batata: 3kg, cenoura: 1.5kg',\n      foto_inventario_base64: ''\n    },\n    \n    // Cen√°rio 7: Cliente fitness (prote√≠nas e vegetais)\n    fitness: {\n      notion_page_id: 'test-notion-page-id-12345',\n      inventario_texto: 'frango: 1.2kg, peixe: 800g, batata doce: 1.5kg, ovos: 18 unidades, azeite: 300ml, quinoa: 400g, br√≥colis: 500g, espinafre: 300g, tomate cereja: 200g, abacate: 3 unidades, lim√£o: 6 unidades, sal rosa: 200g, pimenta: 40g, alho: 2 cabe√ßas',\n      foto_inventario_base64: ''\n    },\n    \n    // Cen√°rio 8: Culin√°ria italiana\n    italiana: {\n      notion_page_id: 'test-notion-page-id-12345',\n      inventario_texto: 'macarr√£o penne: 600g, macarr√£o espaguete: 500g, molho de tomate: 800ml, queijo parmes√£o: 300g, mussarela: 400g, azeite extra virgem: 500ml, manjeric√£o: 50g, or√©gano: 30g, alho: 3 cabe√ßas, cebola: 5 unidades, tomate: 10 unidades, azeitona: 200g, vinho branco: 500ml',\n      foto_inventario_base64: ''\n    },\n    \n    // Cen√°rio 9: Culin√°ria oriental\n    oriental: {\n      notion_page_id: 'test-notion-page-id-12345',\n      inventario_texto: 'arroz japon√™s: 1kg, shoyu: 500ml, miss√¥: 200g, gengibre: 150g, cebolinha: 100g, gergelim: 80g, √≥leo de gergelim: 100ml, sake: 300ml, vinagre de arroz: 200ml, wasabi: 50g, alga nori: 10 folhas, tofu: 400g, cogumelo shiitake: 200g',\n      foto_inventario_base64: ''\n    },\n    \n    // Cen√°rio 10: Churrasco brasileiro\n    churrasco: {\n      notion_page_id: 'test-notion-page-id-12345',\n      inventario_texto: 'picanha: 2kg, costela: 3kg, lingui√ßa: 1.5kg, frango: 2kg, sal grosso: 1kg, pimenta: 100g, alho: 5 cabe√ßas, farofa: 500g, vinagrete: preparado, arroz: 1kg, feij√£o: 800g, batata: 2kg, mandioca: 1.5kg, p√£o de alho: 10 unidades',\n      foto_inventario_base64: ''\n    },\n    \n    // ===== CEN√ÅRIOS DE EDGE CASES =====\n    \n    // Cen√°rio 11: Ingredientes n√£o encontrados (testa Claude)\n    ingredientes_desconhecidos: {\n      notion_page_id: 'test-notion-page-id-12345',\n      inventario_texto: 'arroz: 500g, tempero especial da casa: 100g, mistura de especiarias da vov√≥: 50g, molho secreto: 200ml, farinha especial: 300g',\n      foto_inventario_base64: ''\n    },\n    \n    // Cen√°rio 12: Formata√ß√£o inconsistente (testa parser)\n    formatacao_inconsistente: {\n      notion_page_id: 'test-notion-page-id-12345',\n      inventario_texto: 'arroz 500g; feij√£o, 300g. macarr√£o:250g leite 500ml azeite:200ml sal-500g a√ß√∫car=1kg tomate 5un cebola/3un',\n      foto_inventario_base64: ''\n    },\n    \n    // Cen√°rio 13: Unidades variadas (testa normaliza√ß√£o)\n    unidades_variadas: {\n      notion_page_id: 'test-notion-page-id-12345',\n      inventario_texto: 'arroz: 1 kg, feij√£o: 500 gramas, macarr√£o: 250g, leite: 1 litro, azeite: 200 ml, sal: 0.5kg, a√ß√∫car: 1000g, tomate: meia d√∫zia, ovos: 1 d√∫zia',\n      foto_inventario_base64: ''\n    },\n    \n    // Cen√°rio 14: Invent√°rio vazio (testa erro)\n    vazio: {\n      notion_page_id: 'test-notion-page-id-12345',\n      inventario_texto: '',\n      foto_inventario_base64: ''\n    },\n    \n    // Cen√°rio 15: Invent√°rio muito grande (testa performance)\n    muito_grande: {\n      notion_page_id: 'test-notion-page-id-12345',\n      inventario_texto: 'arroz: 2kg, feij√£o preto: 1kg, feij√£o carioca: 800g, macarr√£o espaguete: 500g, macarr√£o penne: 500g, macarr√£o parafuso: 400g, leite integral: 2L, leite desnatado: 1L, azeite: 500ml, √≥leo de girassol: 900ml, sal: 1kg, a√ß√∫car: 2kg, a√ß√∫car mascavo: 500g, farinha de trigo: 2kg, farinha de milho: 500g, fub√°: 400g, amido de milho: 200g, fermento: 100g, pimenta do reino: 80g, p√°prica: 60g, cominho: 40g, curry: 50g, or√©gano: 30g, manjeric√£o: 25g, alecrim: 20g, tomilho: 20g, canela: 30g, cravo: 15g, noz moscada: 10g, a√ßafr√£o: 40g, tomate: 20 unidades, cebola: 15 unidades, alho: 5 cabe√ßas, batata: 3kg, cenoura: 2kg, beterraba: 1kg, ab√≥bora: 2kg, abobrinha: 1kg, berinjela: 800g, piment√£o: 10 unidades, br√≥colis: 1kg, couve-flor: 800g, couve: 500g, alface: 5 unidades, r√∫cula: 300g, espinafre: 400g',\n      foto_inventario_base64: ''\n    },\n    \n    // ===== CEN√ÅRIOS DE ALIMENTOS ESPEC√çFICOS =====\n    \n    // Cen√°rio 16: Sobremesas e doces\n    sobremesas: {\n      notion_page_id: 'test-notion-page-id-12345',\n      inventario_texto: 'a√ß√∫car: 1kg, farinha de trigo: 800g, ovos: 12 unidades, manteiga: 500g, chocolate em p√≥: 200g, chocolate em barra: 300g, leite condensado: 800g, creme de leite: 600ml, fermento: 100g, baunilha: 50ml, canela: 40g, frutas vermelhas: 500g',\n      foto_inventario_base64: ''\n    },\n    \n    // Cen√°rio 17: Comida de beb√™\n    bebe: {\n      notion_page_id: 'test-notion-page-id-12345',\n      inventario_texto: 'batata: 500g, cenoura: 400g, ab√≥bora: 600g, chuchu: 300g, frango desfiado: 200g, carne mo√≠da: 250g, arroz: 300g, macarr√£o para beb√™: 200g, √≥leo: 100ml, sal: m√≠nimo, a√ß√∫car: m√≠nimo',\n      foto_inventario_base64: ''\n    },\n    \n    // Cen√°rio 18: Dieta low carb\n    low_carb: {\n      notion_page_id: 'test-notion-page-id-12345',\n      inventario_texto: 'frango: 1.5kg, carne: 1kg, peixe: 800g, ovos: 24 unidades, queijo: 500g, manteiga: 400g, azeite: 500ml, br√≥colis: 600g, couve-flor: 500g, espinafre: 300g, abacate: 4 unidades, castanhas: 200g, am√™ndoas: 150g',\n      foto_inventario_base64: ''\n    }\n  };\n  \n  // Selecionar cen√°rio\n  if (!cenarios[CENARIO_TESTE]) {\n    console.warn('‚ö†Ô∏è Cen√°rio n√£o encontrado:', CENARIO_TESTE);\n    console.log('üìã Cen√°rios dispon√≠veis:', Object.keys(cenarios).join(', '));\n    payload = cenarios.completo;\n  } else {\n    payload = cenarios[CENARIO_TESTE];\n  }\n  \n  console.log('üß™ MODO TESTE ATIVO - Cen√°rio:', CENARIO_TESTE);\n  console.log('üì¶ Payload de teste:', payload);\n  \n} else {\n  // ===== MODO PRODU√á√ÉO (usa dados do webhook) =====\n  const webhookData = $input.first().json;\n  \n  payload = {\n    notion_page_id: webhookData.body?.notion_page_id || webhookData.notion_page_id || '',\n    inventario_texto: webhookData.body?.inventario_texto || webhookData.inventario_texto || '',\n    foto_inventario_base64: webhookData.body?.foto_inventario_base64 || webhookData.foto_inventario_base64 || ''\n  };\n  \n  console.log('üöÄ MODO PRODU√á√ÉO - Dados do webhook');\n  console.log('üì¶ Payload:', { \n    ...payload, \n    foto_inventario_base64: payload.foto_inventario_base64 ? payload.foto_inventario_base64.length + ' chars' : 'empty' \n  });\n}\n\n// Retornar payload no formato esperado\nreturn {\n  json: {\n    notion_page_id: payload.notion_page_id,\n    inventario_texto: payload.inventario_texto,\n    foto_inventario_base64: payload.foto_inventario_base64,\n    modo_teste: MODO_TESTE,\n    cenario_teste: MODO_TESTE ? CENARIO_TESTE : null\n  }\n};"
      },
      "id": "9fb42224-a67b-4ca1-9ba1-3a63d285754a",
      "name": "Code - Payload de Teste",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -256,
        -432
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "notion_page_id",
              "name": "notion_page_id",
              "value": "={{ $json.notion_page_id }}",
              "type": "string"
            },
            {
              "id": "inventario_texto",
              "name": "inventario_texto",
              "value": "={{ $json.inventario_texto }}",
              "type": "string"
            },
            {
              "id": "foto_inventario_base64",
              "name": "foto_inventario_base64",
              "value": "={{ $json.foto_inventario_base64 }}",
              "type": "string"
            },
            {
              "id": "modo_teste",
              "name": "modo_teste",
              "value": "={{ $json.modo_teste }}",
              "type": "boolean"
            },
            {
              "id": "cenario_teste",
              "name": "cenario_teste",
              "value": "={{ $json.cenario_teste }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "158b0872-6fb5-438e-95e8-7c81c73e7b0c",
      "name": "Set - Extrai Vari√°veis",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        -16,
        -432
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "inventario_extraido",
              "name": "inventario_extraido",
              "value": "={{ $('Set - Extrai Vari√°veis').first().json.inventario_texto }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "5c328800-3ea6-494b-b2a9-b1ab028a3061",
      "name": "Set - Usa Texto Digitado",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        272,
        -432
      ]
    },
    {
      "parameters": {
        "jsCode": "// ===== CODE - PROCESSAR INVENT√ÅRIO (VERS√ÉO SIMPLES - CORRIGIDO) =====\n// Objetivo: Parse simples + valida√ß√£o de temperos sens√≠veis + visualiza√ß√£o\n\nconst inventarioTexto = $input.first().json.inventario_extraido || '';\n\nif (!inventarioTexto || typeof inventarioTexto !== 'string') {\n  return {\n    json: {\n      success: false,\n      erro: 'Invent√°rio n√£o encontrado ou vazio'\n    }\n  };\n}\n\nconsole.log('üì¶ Invent√°rio recebido:', inventarioTexto);\n\n// ===== LISTA DE TEMPEROS SENS√çVEIS =====\n// Temperos que SEMPRE devem ser revisados pelo chef\nconst temperosSensiveis = [\n  'pimenta do reino',\n  'pimenta',\n  'a√ßafr√£o',\n  'a√ßafr√£o da terra',\n  'c√∫rcuma',\n  'canela',\n  'p√°prica',\n  'cominho',\n  'curry',\n  'noz-moscada',\n  'pimenta caiena',\n  'pimenta de cheiro',\n  'pimenta dedo de mo√ßa',\n  'piment√£o',\n  'zatar',\n  'pimenta verde'\n];\n\n// ===== FUN√á√ÉO: Normalizar texto para compara√ß√£o =====\nfunction normalizarTexto(texto) {\n  if (!texto) return '';\n  return texto\n    .normalize('NFD')\n    .replace(/[\\u0300-\\u036f]/g, '') // Remove acentos\n    .toLowerCase()\n    .trim();\n}\n\n// ===== FUN√á√ÉO: Verificar se ingrediente √© tempero sens√≠vel =====\nfunction ehTemperoSensivel(nomeIngrediente) {\n  const nomeNormalizado = normalizarTexto(nomeIngrediente);\n  \n  for (const tempero of temperosSensiveis) {\n    const temperoNormalizado = normalizarTexto(tempero);\n    if (nomeNormalizado.includes(temperoNormalizado)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n// ===== PARSE SIMPLES =====\nconst ingredientes = inventarioTexto\n  .split(/[,\\n;]/) // Separa por v√≠rgula, quebra de linha ou ponto-e-v√≠rgula\n  .map(item => item.trim())\n  .filter(item => item.length > 0)\n  .map(ingredienteTexto => {\n    // Extrair nome, quantidade e unidade\n    let nome = ingredienteTexto;\n    let quantidade = '';\n    let unidade = '';\n\n    // Tentar com dois-pontos: \"ingrediente: quantidade unidade\"\n    const matchComDoisPontos = ingredienteTexto.match(/^(.+?)\\s*:\\s*(\\d+(?:[.,]\\d+)?)\\s*(g|kg|ml|l|litros?|unidade|unidades|un|pct|pacote|pacotes|unid|cabe√ßa|cabe√ßas|ma√ßo|ma√ßos)?$/i);\n    \n    if (matchComDoisPontos) {\n      nome = matchComDoisPontos[1].trim();\n      quantidade = matchComDoisPontos[2].replace(',', '.');\n      unidade = (matchComDoisPontos[3] || 'unidade').toLowerCase();\n    } else {\n      // Tentar sem dois-pontos: \"ingrediente quantidade unidade\"\n      const matchSemDoisPontos = ingredienteTexto.match(/^(.+?)\\s+(\\d+(?:[.,]\\d+)?)\\s*(g|kg|ml|l|litros?|unidade|unidades|un|pct|pacote|pacotes|unid|cabe√ßa|cabe√ßas|ma√ßo|ma√ßos)?$/i);\n      if (matchSemDoisPontos) {\n        nome = matchSemDoisPontos[1].trim();\n        quantidade = matchSemDoisPontos[2].replace(',', '.');\n        unidade = (matchSemDoisPontos[3] || 'unidade').toLowerCase();\n      }\n    }\n\n    // Normalizar unidades comuns\n    const unidadesMap = {\n      'un': 'unidade',\n      'unid': 'unidade',\n      'unidades': 'unidade',\n      'pct': 'pacote',\n      'pacotes': 'pacote',\n      'litros': 'l',\n      'litro': 'l',\n      'ma√ßos': 'ma√ßo',\n      'cabe√ßas': 'cabe√ßa'\n    };\n    \n    unidade = unidadesMap[unidade] || unidade;\n\n    // Verificar se √© tempero sens√≠vel\n    const isTemperoSensivel = ehTemperoSensivel(nome);\n\n    return {\n      nome_original: ingredienteTexto,\n      nome: nome,\n      quantidade: quantidade,\n      unidade: unidade,\n      tempero_sensivel: isTemperoSensivel\n    };\n  });\n\nconsole.log('üìã Total de ingredientes parseados:', ingredientes.length);\n\n// ===== AN√ÅLISE DE TEMPEROS SENS√çVEIS =====\nconst temperosSensiveisEncontrados = ingredientes.filter(item => item.tempero_sensivel);\nconst totalTemperos = temperosSensiveisEncontrados.length;\n\nconsole.log('‚ö†Ô∏è Temperos sens√≠veis encontrados:', totalTemperos);\n\n// ===== VALIDA√á√ÉO DE TEMPEROS (MENSAGENS OPERACIONAIS CORRETAS) =====\nlet avisoTemperos = null;\nlet precisaRevisaoTemperos = false;\n\nif (totalTemperos === 0) {\n  avisoTemperos = 'üö® ATEN√á√ÉO CR√çTICA: Nenhum tempero sens√≠vel registrado!\\n\\nüîç REVISE SE SOBRARAM TEMPEROS que voc√™ usou:\\n‚Ä¢ Pimenta do reino\\n‚Ä¢ P√°prica\\n‚Ä¢ Cominho\\n‚Ä¢ Curry\\n‚Ä¢ Canela\\n‚Ä¢ A√ßafr√£o/C√∫rcuma\\n‚Ä¢ Outros temperos\\n\\nüí∞ IMPACTO OPERACIONAL:\\nSe sobraram temperos e voc√™ N√ÉO registrou, o sistema vai RECOMPR√Å-LOS DESNECESSARIAMENTE na pr√≥xima visita, gerando:\\n‚Üí Desperd√≠cio de produto\\n‚Üí Aumento de custos\\n‚Üí Estoque duplicado\\n\\n‚ùì Confirma que N√ÉO SOBRARAM temperos sens√≠veis para registrar?';\n  precisaRevisaoTemperos = true;\n} else if (totalTemperos === 1) {\n  avisoTemperos = `‚ö†Ô∏è ATEN√á√ÉO: Apenas 1 tempero sens√≠vel registrado!\\n\\nTempero encontrado:\\n‚Ä¢ ${temperosSensiveisEncontrados[0].nome}: ${temperosSensiveisEncontrados[0].quantidade}${temperosSensiveisEncontrados[0].unidade}\\n\\nüîç REVISE: √â comum usar v√°rios temperos em uma visita.\\nVerifique se SOBRARAM outros temperos que voc√™ usou.\\n\\nüí∞ IMPACTO: Temperos n√£o registrados ser√£o recomprados desnecessariamente.\\n\\n‚ùì Confirma que APENAS esse tempero sobrou?`;\n  precisaRevisaoTemperos = true;\n} else if (totalTemperos === 2) {\n  const nomesTemperos = temperosSensiveisEncontrados.map(t => `‚Ä¢ ${t.nome}: ${t.quantidade}${t.unidade}`).join('\\n');\n  avisoTemperos = `‚ö†Ô∏è ATEN√á√ÉO: Apenas 2 temperos sens√≠veis registrados!\\n\\nTemperos encontrados:\\n${nomesTemperos}\\n\\nüîç REVISE: √â comum usar mais temperos em uma visita completa.\\nVerifique se SOBRARAM outros temperos que voc√™ usou.\\n\\nüí∞ IMPACTO: Temperos n√£o registrados ser√£o recomprados desnecessariamente.\\n\\n‚ùì Confirma que APENAS esses 2 temperos sobraram?`;\n  precisaRevisaoTemperos = true;\n}\n\n// ===== FORMATAR VISUALIZA√á√ÉO =====\nlet inventarioVisualizacao = '';\n\ninventarioVisualizacao += 'üì¶ INVENT√ÅRIO PROCESSADO\\n';\ninventarioVisualizacao += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\\n\\n';\n\n// Agrupar por tipo (temperos sens√≠veis primeiro)\nconst temperos = ingredientes.filter(item => item.tempero_sensivel);\nconst normais = ingredientes.filter(item => !item.tempero_sensivel);\n\nif (temperos.length > 0) {\n  inventarioVisualizacao += '‚ö†Ô∏è TEMPEROS SENS√çVEIS:\\n';\n  temperos.forEach((item, index) => {\n    inventarioVisualizacao += `   ${index + 1}. ${item.nome}`;\n    if (item.quantidade) {\n      inventarioVisualizacao += `: ${item.quantidade} ${item.unidade}`;\n    }\n    inventarioVisualizacao += '\\n';\n  });\n  inventarioVisualizacao += '\\n';\n}\n\nif (normais.length > 0) {\n  inventarioVisualizacao += 'üìã INGREDIENTES GERAIS:\\n';\n  normais.forEach((item, index) => {\n    inventarioVisualizacao += `   ${index + 1}. ${item.nome}`;\n    if (item.quantidade) {\n      inventarioVisualizacao += `: ${item.quantidade} ${item.unidade}`;\n    }\n    inventarioVisualizacao += '\\n';\n  });\n}\n\ninventarioVisualizacao += '\\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\\n';\ninventarioVisualizacao += `üìä TOTAL: ${ingredientes.length} ingredientes\\n`;\ninventarioVisualizacao += `‚ö†Ô∏è TEMPEROS SENS√çVEIS: ${totalTemperos}\\n\\n`;\n\n// Adicionar aviso de temperos se necess√°rio\nif (avisoTemperos) {\n  inventarioVisualizacao += avisoTemperos + '\\n\\n';\n}\n\ninventarioVisualizacao += '‚úÖ Confirma que est√° correto?\\n';\ninventarioVisualizacao += '‚úÖ Sim ‚Üí Tudo certo!\\n';\ninventarioVisualizacao += '‚ùå N√£o ‚Üí Me manda corrigido';\n\n// ===== RETORNAR RESULTADO =====\nreturn {\n  json: {\n    success: true,\n    inventario_estruturado: ingredientes,\n    inventario_visualizacao: inventarioVisualizacao,\n    total_ingredientes: ingredientes.length,\n    temperos_sensiveis: temperosSensiveisEncontrados,\n    total_temperos_sensiveis: totalTemperos,\n    precisa_revisao_temperos: precisaRevisaoTemperos,\n    aviso_temperos: avisoTemperos,\n    metodo: 'parse_simples',\n    precisa_validacao: true\n  }\n};"
      },
      "id": "1059fa80-2307-4465-8390-6044118e0266",
      "name": "Code - Processar Invent√°rio",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        512,
        -432
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify({\n  success: $json.success || false,\n  inventario_estruturado: $json.inventario_estruturado || [],\n  inventario_visualizacao: $json.inventario_visualizacao || '',\n  total_ingredientes: $json.total_ingredientes || 0,\n  temperos_sensiveis: $json.temperos_sensiveis || [],\n  total_temperos_sensiveis: $json.total_temperos_sensiveis || 0,\n  precisa_revisao_temperos: $json.precisa_revisao_temperos || false,\n  aviso_temperos: $json.aviso_temperos || null,\n  metodo: $json.metodo || 'parse_simples',\n  precisa_validacao: $json.precisa_validacao !== undefined ? $json.precisa_validacao : true,\n  message: $json.success ? 'Invent√°rio processado com sucesso' : ($json.erro || 'Erro ao processar invent√°rio')\n}) }}",
        "options": {}
      },
      "id": "27c989c3-30ac-4e73-93c3-1ff824437574",
      "name": "Respond - Retorna pro Bot",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        800,
        -432
      ]
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook - Recebe do Bot": {
      "main": [
        [
          {
            "node": "Code - Payload de Teste",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code - Payload de Teste": {
      "main": [
        [
          {
            "node": "Set - Extrai Vari√°veis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set - Extrai Vari√°veis": {
      "main": [
        [
          {
            "node": "Set - Usa Texto Digitado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set - Usa Texto Digitado": {
      "main": [
        [
          {
            "node": "Code - Processar Invent√°rio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code - Processar Invent√°rio": {
      "main": [
        [
          {
            "node": "Respond - Retorna pro Bot",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "a6bdaf00-d6ba-4be2-b161-4a48eddf51f3",
  "meta": {
    "instanceId": "23fd11dbb65f405d9439226230861dcd2be8bf8c9bcfdf11d867e1e6075d97ef"
  },
  "id": "OXxsVFeLsMkIZqqd",
  "tags": []
}